

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>nirfasterff.base.data &mdash; NIRFASTerFF 1.1.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=92fd9be5" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=7a812f30"></script>
      <script src="../../../_static/doctools.js?v=888ff710"></script>
      <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            NIRFASTerFF
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../_autosummary/nirfasterff.html">nirfasterff</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">NIRFASTerFF</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">nirfasterff.base.data</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for nirfasterff.base.data</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defining some data classes, which are the return types of the fem data calculation functions</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">sparse</span>

<div class="viewcode-block" id="meshvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.meshvol.html#nirfasterff.base.data.meshvol">[docs]</a><span class="k">class</span> <span class="nc">meshvol</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Small class holding the information needed for converting between mesh and volumetric space. Values calculated by nirfasterff.base.*mesh.gen_intmat</span>
<span class="sd">    </span>
<span class="sd">    Note that the volumetric space, defined by xgrid, ygrid, and zgrid (empty for 2D mesh), must be uniform</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        xgrid: double Numpy array</span>
<span class="sd">            x grid of the volumetric space. In mm</span>
<span class="sd">        ygrid: double Numpy array</span>
<span class="sd">            y grid of the volumetric space. In mm</span>
<span class="sd">        zgrid: double Numpy array</span>
<span class="sd">            z grid of the volumetric space. In mm. Empty for 2D meshes</span>
<span class="sd">        mesh2grid: double CSR sparse matrix</span>
<span class="sd">            matrix converting a vector in mesh space to volumetric space, done by mesh2grid.dot(data)</span>
<span class="sd">            </span>
<span class="sd">            The result is vectorized in &#39;F&#39; (Matlab) order</span>
<span class="sd">            </span>
<span class="sd">            Size: (len(xgrid)*len(ygrid)*len(zgrid), NNodes)</span>
<span class="sd">        gridinmesh: int32 NumPy array</span>
<span class="sd">            indices (one-based) of data points in the volumetric space that are within the mesh space, vectorized in &#39;F&#39; order.</span>
<span class="sd">        res: double NumPy array</span>
<span class="sd">            resolution in x, y, z (if 3D) direction, in mm. Size (2,) or (3,)</span>
<span class="sd">        grid2mesh: double CSR sparse matrix</span>
<span class="sd">            matrix converting volumetric data, vectorized in &#39;F&#39; order, to mesh space. Done by grid2mesh.dot(data)</span>
<span class="sd">            </span>
<span class="sd">            Size (Nnodes, len(xgrid)*len(ygrid)*len(ygrid))</span>
<span class="sd">        meshingrid: int32 NumPy array</span>
<span class="sd">            indices (one-based) of data points in the mesh space that are within the volumetric space</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="meshvol.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.meshvol.html#nirfasterff.base.data.meshvol.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xgrid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ygrid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zgrid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh2grid</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridinmesh</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid2mesh</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">csc_matrix</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshingrid</span> <span class="o">=</span> <span class="p">[]</span></div></div>

<div class="viewcode-block" id="FDdata"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FDdata.html#nirfasterff.base.data.FDdata">[docs]</a><span class="k">class</span> <span class="nc">FDdata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding FD/CW data.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    phi: double Numpy array</span>
<span class="sd">        Fluence from each source. If mesh contains non-tempty field vol, this will be represented on the grid. Last dimension has the size of the number of sources</span>
<span class="sd">    complex: double or complex double Numpy vector</span>
<span class="sd">        Complex amplitude of each channel. Same as amplitude in case of CW data</span>
<span class="sd">    link: int32 NumPy array</span>
<span class="sd">        Defining all the channels (i.e. source-detector pairs). Copied from mesh.link</span>
<span class="sd">    amplitude: double Numpy vector</span>
<span class="sd">        Absolute amplitude of each channel. I.e. amplitude=abs(complex)</span>
<span class="sd">    phase: double Numpy vector</span>
<span class="sd">        phase data of each channel. All zero in case of CW data</span>
<span class="sd">    vol: nirfaseterff.base.meshvol</span>
<span class="sd">        Information needed to convert between volumetric and mesh space. Copied from mesh.vol</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FDdata.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FDdata.html#nirfasterff.base.data.FDdata.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phase</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="FDdata.togrid"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FDdata.html#nirfasterff.base.data.FDdata.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data to volumetric space as is defined in mesh.vol. If it is empty, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        If data is already in volumetric space, function casts data to the new volumetric space</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the field phi</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.stndmesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in volumetric space. Recasted to the new volume.&#39;</span><span class="p">)</span>
                <span class="n">phi_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: no converting information found. Ignored. Please run mesh.gen_intmat() first.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FDdata.tomesh"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FDdata.html#nirfasterff.base.data.FDdata.tomesh">[docs]</a>    <span class="k">def</span> <span class="nf">tomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data back to mesh space using information defined in mesh.vol. If data.vol is empty, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the field phi</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.stndmesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in mesh space. Ignored.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="FDdata.isvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FDdata.html#nirfasterff.base.data.FDdata.isvol">[docs]</a>    <span class="k">def</span> <span class="nf">isvol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if data is in volumetric space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if data is in volumetric space, False if not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>

<div class="viewcode-block" id="FLdata"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FLdata.html#nirfasterff.base.data.FLdata">[docs]</a><span class="k">class</span> <span class="nc">FLdata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding FD/CW fluorescence data.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        phix: double Numpy array</span>
<span class="sd">            intrinsic fluence from each source at excitation wavelength. If mesh contains non-tempty field vol, this will be represented on the grid. Last dimension has the size of the number of sources</span>
<span class="sd">        phimm: double Numpy array </span>
<span class="sd">            intrinsic from each source at emission wavelength.</span>
<span class="sd">        phifl: double Numpy array </span>
<span class="sd">            fluorescence emission fluence</span>
<span class="sd">        complexx: double or complex double Numpy vector</span>
<span class="sd">            Complex amplitude of each channel, intrinsic excitation. Same as amplitude in case of CW data</span>
<span class="sd">        complexmm: double or complex double Numpy vector</span>
<span class="sd">            Complex amplitude of each channel, intrinsic emission. Same as amplitude in case of CW data</span>
<span class="sd">        complexfl: double or complex double Numpy vector</span>
<span class="sd">            Complex amplitude of each channel, fluorescence emission. Same as amplitude in case of CW data</span>
<span class="sd">        link: int32 NumPy array</span>
<span class="sd">            Defining all the channels (i.e. source-detector pairs). Copied from mesh.link</span>
<span class="sd">        amplitudex: double Numpy vector</span>
<span class="sd">            Absolute amplitude of each channel, intrinsic excitation. I.e. amplitudex=abs(complexx)</span>
<span class="sd">        amplitudemm: double Numpy vector</span>
<span class="sd">            Absolute amplitude of each channel, intrinsic emission. I.e. amplitudemm=abs(complexmm)</span>
<span class="sd">        amplitudefl: double Numpy vector</span>
<span class="sd">            Absolute amplitude of each channel, fluorescence emission. I.e. amplitudefl=abs(complexfl)</span>
<span class="sd">        phasex: double Numpy vector</span>
<span class="sd">            phase data of each channel, intrinsic excitation. All zero in case of CW data</span>
<span class="sd">        phasemm: double Numpy vector</span>
<span class="sd">            phase data of each channel, intrinsic emission. All zero in case of CW data</span>
<span class="sd">        phasefl: double Numpy vector</span>
<span class="sd">            phase data of each channel, fluorescence emission. All zero in case of CW data</span>
<span class="sd">        vol: nirfaseterff.base.meshvol</span>
<span class="sd">            Information needed to convert between volumetric and mesh space. Copied from mesh.vol</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="FLdata.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FLdata.html#nirfasterff.base.data.FLdata.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phimm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complexx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complexmm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">complexfl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitudex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitudemm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitudefl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasex</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasemm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phasefl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="FLdata.togrid"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FLdata.html#nirfasterff.base.data.FLdata.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data to volumetric space as is defined in mesh.vol. If it is empty, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        If data is already in volumetric space, function casts data to the new volumetric space</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the fields phix, phimm, and phifl, if they are defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">xflag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
        <span class="n">mmflag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
        <span class="n">flflag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
        <span class="n">tmpx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tmpmm</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tmpfl</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in volumetric space. Recasted to the new volume.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">xflag</span><span class="p">:</span>
                    <span class="n">phix_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">mmflag</span><span class="p">:</span>
                    <span class="n">phimm_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">flflag</span><span class="p">:</span>
                    <span class="n">phifl_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                    
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xflag</span><span class="p">:</span>
                        <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mmflag</span><span class="p">:</span>
                        <span class="n">tmpmm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phimm_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">flflag</span><span class="p">:</span>
                        <span class="n">tmpfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phifl_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xflag</span><span class="p">:</span>
                        <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mmflag</span><span class="p">:</span>
                        <span class="n">tmpmm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phimm_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">flflag</span><span class="p">:</span>
                        <span class="n">tmpfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phifl_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xflag</span><span class="p">:</span>
                        <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mmflag</span><span class="p">:</span>
                        <span class="n">tmpmm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">flflag</span><span class="p">:</span>
                        <span class="n">tmpfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xflag</span><span class="p">:</span>
                        <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">mmflag</span><span class="p">:</span>
                        <span class="n">tmpmm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">flflag</span><span class="p">:</span>
                        <span class="n">tmpfl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="n">tmpx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phimm</span> <span class="o">=</span> <span class="n">tmpmm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="n">tmpfl</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: no converting information found. Ignored. Please run mesh.gen_intmat() first.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="FLdata.tomesh"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FLdata.html#nirfasterff.base.data.FLdata.tomesh">[docs]</a>    <span class="k">def</span> <span class="nf">tomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data back to mesh space using information defined in mesh.vol. If data.vol is empty, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES fields phix, phimm, and phifl, if they are defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in mesh space. Ignored.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xflag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
            <span class="n">mmflag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
            <span class="n">flflag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>
            <span class="k">if</span> <span class="n">xflag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">mmflag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phimm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phimm</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">flflag</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="FLdata.isvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.FLdata.html#nirfasterff.base.data.FLdata.isvol">[docs]</a>    <span class="k">def</span> <span class="nf">isvol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if data is in volumetric space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if data is in volumetric space, False if not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>

<div class="viewcode-block" id="TRMomentsdata"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TRMomentsdata.html#nirfasterff.base.data.TRMomentsdata">[docs]</a><span class="k">class</span> <span class="nc">TRMomentsdata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding time-resolved moments data calculated using Mellin transform.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        phi: double Numpy array or None</span>
<span class="sd">            moments from each source at each spatial location. If mesh contains non-tempty field vol, this will be represented on the grid</span>
<span class="sd">            </span>
<span class="sd">            Shape: NNodes x num_sources x (max_moment_order + 1)</span>
<span class="sd">            </span>
<span class="sd">            OR: len(xgrid) x len(ygrid) x len(zgrid) x num_sources x (max_moment_order + 1)</span>
<span class="sd">            </span>
<span class="sd">            None by default, and only contains data if &#39;field&#39; option is set to True when calculating forward data.</span>
<span class="sd">        moments: double Numpy vector</span>
<span class="sd">            moments for each channel. i-th column contains i-th moment as measured at each channel. Size: (NChannels, max_moment_order + 1)</span>
<span class="sd">        link: int32 NumPy array</span>
<span class="sd">            Defining all the channels (i.e. source-detector pairs). Copied from mesh.link</span>
<span class="sd">        vol: nirfaseterff.base.meshvol</span>
<span class="sd">            Information needed to convert between volumetric and mesh space. Copied from mesh.vol</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TRMomentsdata.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TRMomentsdata.html#nirfasterff.base.data.TRMomentsdata.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">moments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="TRMomentsdata.togrid"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TRMomentsdata.html#nirfasterff.base.data.TRMomentsdata.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data to volumetric space as is defined in mesh.vol. If it is empty or data.phi==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        If data is already in volumetric space, function casts data to the new volumetric space</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the field phi, if it is defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.stndmesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in volumetric space. Recasted to the new volume.&#39;</span><span class="p">)</span>
                <span class="n">phi_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: no converting information found. Ignored. Please run mesh.gen_intmat() first.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TRMomentsdata.tomesh"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TRMomentsdata.html#nirfasterff.base.data.TRMomentsdata.tomesh">[docs]</a>    <span class="k">def</span> <span class="nf">tomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data back to mesh space using information defined in mesh.vol. If data.vol is empty or data.phi==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES field phi, if it is defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in mesh space. Ignored.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="TRMomentsdata.isvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TRMomentsdata.html#nirfasterff.base.data.TRMomentsdata.isvol">[docs]</a>    <span class="k">def</span> <span class="nf">isvol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if data is in volumetric space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if data is in volumetric space, False if not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>

<div class="viewcode-block" id="TPSFdata"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TPSFdata.html#nirfasterff.base.data.TPSFdata">[docs]</a><span class="k">class</span> <span class="nc">TPSFdata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding time-resolved TPSF data.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        phi: double NumPy array or None</span>
<span class="sd">            TPSF from each source at each spatial location. If mesh contains non-tempty field vol, this will be represented on the grid</span>
<span class="sd">            </span>
<span class="sd">            Shape: NNodes x num_sources x time_steps</span>
<span class="sd">            </span>
<span class="sd">            OR: len(xgrid) x len(ygrid) x len(zgrid) x num_sources x time_steps</span>
<span class="sd">            </span>
<span class="sd">            None by default, and only contains data if &#39;field&#39; option is set to True when calculating forward data.</span>
<span class="sd">        time: double NumPy vector</span>
<span class="sd">            time vector, in seconds</span>
<span class="sd">        tpsf: double NumPy array</span>
<span class="sd">            TPSF measured at each channel. Size: (NChannels, time_steps)</span>
<span class="sd">        link: int32 NumPy array</span>
<span class="sd">            Defining all the channels (i.e. source-detector pairs). Copied from mesh.link</span>
<span class="sd">        vol: nirfaseterff.base.meshvol</span>
<span class="sd">            Information needed to convert between volumetric and mesh space. Copied from mesh.vol</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TPSFdata.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TPSFdata.html#nirfasterff.base.data.TPSFdata.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpsf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="TPSFdata.togrid"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TPSFdata.html#nirfasterff.base.data.TPSFdata.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data to volumetric space as is defined in mesh.vol. If it is empty or data.phi==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        If data is already in volumetric space, function casts data to the new volumetric space</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the field phi, if it is defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.stndmesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in volumetric space. Recasted to the new volume.&#39;</span><span class="p">)</span>
                <span class="n">phi_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phi_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_tmp</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_tmp</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">tmp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: no converting information found. Ignored. Please run mesh.gen_intmat() first.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TPSFdata.tomesh"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TPSFdata.html#nirfasterff.base.data.TPSFdata.tomesh">[docs]</a>    <span class="k">def</span> <span class="nf">tomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data back to mesh space using information defined in mesh.vol. If data.vol is empty or data.phi==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES field phi, if it is defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in mesh space. Ignored.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="TPSFdata.isvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.TPSFdata.html#nirfasterff.base.data.TPSFdata.isvol">[docs]</a>    <span class="k">def</span> <span class="nf">isvol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if data is in volumetric space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if data is in volumetric space, False if not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>

<div class="viewcode-block" id="flTRMomentsdata"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTRMomentsdata.html#nirfasterff.base.data.flTRMomentsdata">[docs]</a><span class="k">class</span> <span class="nc">flTRMomentsdata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding fluorescence TR moments data calculated using Mellin transform.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        phix: double NumPy array</span>
<span class="sd">            moments at excitation wavelength from each source at each spatial location. If mesh contains non-tempty field vol, this will be represented on the grid</span>
<span class="sd">            </span>
<span class="sd">            Shape: NNodes x num_sources x (max_moment_order + 1)</span>
<span class="sd">            </span>
<span class="sd">            OR: len(xgrid) x len(ygrid) x len(zgrid) x num_sources x (max_moment_order + 1)</span>
<span class="sd">            </span>
<span class="sd">            None by default, and only contains data if &#39;field&#39; option is set to True when calculating forward data.</span>
<span class="sd">        phifl: double NumPy array</span>
<span class="sd">            similar to phix, but for fluorescence emission</span>
<span class="sd">        momentsx: double NumPy array</span>
<span class="sd">            moments for each channel, exciation. i-th column contains i-th moment. Size: (NChannels, max_moment_order + 1)</span>
<span class="sd">        momentsfl: double NumPy array</span>
<span class="sd">            moments for each channel, fluorescence emission. i-th column contains i-th moment. Size: (NChannels, max_moment_order + 1)</span>
<span class="sd">        link: int32 NumPy array</span>
<span class="sd">            Defining all the channels (i.e. source-detector pairs). Copied from mesh.link</span>
<span class="sd">        vol: nirfaseterff.base.meshvol</span>
<span class="sd">            Information needed to convert between volumetric and mesh space. Copied from mesh.vol</span>

<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="flTRMomentsdata.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTRMomentsdata.html#nirfasterff.base.data.flTRMomentsdata.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">momentsx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">momentsfl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="flTRMomentsdata.togrid"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTRMomentsdata.html#nirfasterff.base.data.flTRMomentsdata.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data to volumetric space as is defined in mesh.vol. If it is empty or data.phix==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        If data is already in volumetric space, function casts data to the new volumetric space</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the fields phix and phifl, if they are defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in volumetric space. Recasted to the new volume.&#39;</span><span class="p">)</span>
                <span class="n">phix_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="n">phifl_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phifl_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phifl_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="n">tmpx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="n">tmpm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: no converting information found. Ignored. Please run mesh.gen_intmat() first.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="flTRMomentsdata.tomesh"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTRMomentsdata.html#nirfasterff.base.data.flTRMomentsdata.tomesh">[docs]</a>    <span class="k">def</span> <span class="nf">tomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data back to mesh space using information defined in mesh.vol. If data.vol is empty or data.phix==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES fields phix and phifl, if they are defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in mesh space. Ignored.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="flTRMomentsdata.isvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTRMomentsdata.html#nirfasterff.base.data.flTRMomentsdata.isvol">[docs]</a>    <span class="k">def</span> <span class="nf">isvol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if data is in volumetric space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if data is in volumetric space, False if not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>

<div class="viewcode-block" id="flTPSFdata"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTPSFdata.html#nirfasterff.base.data.flTPSFdata">[docs]</a><span class="k">class</span> <span class="nc">flTPSFdata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding fluorescence time-resolved TPSF data.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        phix: double NumPy array</span>
<span class="sd">            TPSF at exciation wavelength from each source at each spatial location. If mesh contains non-tempty field vol, this will be represented on the grid</span>
<span class="sd">            </span>
<span class="sd">            Shape: NNodes x num_sources x time_steps</span>
<span class="sd">            </span>
<span class="sd">            OR: len(xgrid) x len(ygrid) x len(zgrid) x num_sources x time_steps</span>
<span class="sd">            </span>
<span class="sd">            None by default, and only contains data if &#39;field&#39; option is set to True when calculating forward data.</span>
<span class="sd">        phifl: double NumPy array</span>
<span class="sd">            similar to phix, but for fluorescence emission</span>
<span class="sd">        time: double NumPy vector</span>
<span class="sd">            time vector, in seconds</span>
<span class="sd">        tpsfx: double NumPy array</span>
<span class="sd">            TPSF measured at each channel, excitation. Size: (NChannels, time_steps)</span>
<span class="sd">        link: int32 NumPy array</span>
<span class="sd">            Defining all the channels (i.e. source-detector pairs). Copied from mesh.link</span>
<span class="sd">        vol: nirfaseterff.base.meshvol</span>
<span class="sd">            Information needed to convert between volumetric and mesh space. Copied from mesh.vol</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="flTPSFdata.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTPSFdata.html#nirfasterff.base.data.flTPSFdata.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpsfx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tpsffl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="flTPSFdata.togrid"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTPSFdata.html#nirfasterff.base.data.flTPSFdata.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data to volumetric space as is defined in mesh.vol. If it is empty or data.phix==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        If data is already in volumetric space, function casts data to the new volumetric space</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the fields phix and phifl, if they are defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in volumetric space. Recasted to the new volume.&#39;</span><span class="p">)</span>
                <span class="n">phix_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="n">phifl_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phifl_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phifl_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">phix_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="n">phi</span><span class="p">,</span><span class="n">_tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_tmp</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tmpm</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmpx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phix_tmp</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmpm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">tmpm</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="n">tmpx</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="n">tmpm</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: no converting information found. Ignored. Please run mesh.gen_intmat() first.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="flTPSFdata.tomesh"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTPSFdata.html#nirfasterff.base.data.flTPSFdata.tomesh">[docs]</a>    <span class="k">def</span> <span class="nf">tomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data back to mesh space using information defined in mesh.vol. If data.vol is empty or data.phix==None, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES fields phix and phifl, if they are defined</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.fluormesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">==</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">return</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in mesh space. Ignored.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phifl</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="flTPSFdata.isvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.flTPSFdata.html#nirfasterff.base.data.flTPSFdata.isvol">[docs]</a>    <span class="k">def</span> <span class="nf">isvol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if data is in volumetric space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if data is in volumetric space, False if not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>

<div class="viewcode-block" id="DCSdata"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.DCSdata.html#nirfasterff.base.data.DCSdata">[docs]</a><span class="k">class</span> <span class="nc">DCSdata</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding DCS data.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        phi: double NumPy array</span>
<span class="sd">            steady-state fluence from each source. If mesh contains non-tempty field vol, this will be represented on the grid. </span>
<span class="sd">            </span>
<span class="sd">            Last dimension has the size of the number of sources</span>
<span class="sd">            </span>
<span class="sd">            This is the same as nirfasterff.base.FDdata.phi, when modulation frequency is zero</span>
<span class="sd">            </span>
<span class="sd">        link: int32 NumPy array</span>
<span class="sd">            Defining all the channels (i.e. source-detector pairs). Copied from mesh.link</span>
<span class="sd">        amplitude: double NumPy vector</span>
<span class="sd">            Steady-state amplitude of each channel. Size (NChannel,)</span>
<span class="sd">            </span>
<span class="sd">            This is the same as nirfasterff.base.FDdata.amplitude, when modulation frequency is zero</span>
<span class="sd">        tau_DCS: double NumPy vector</span>
<span class="sd">            time vector in seconds</span>
<span class="sd">        phi_DCS: double NumPy array</span>
<span class="sd">            G1 in medium from each source at each time step . If mesh contains non-tempty field vol, this will be represented on the grid</span>
<span class="sd">            </span>
<span class="sd">            shape[-1] equals length of tau_DCS, and shape[-2] equals number of sources</span>
<span class="sd">        G1_DCS: double NumPy array</span>
<span class="sd">            G1 curve as is calculated from the correlation diffusion equation. Size: (NChannel, NTime)</span>
<span class="sd">        g1_DCS: double NumPy array</span>
<span class="sd">            g1 curve, i.e. G1 normalized by amplitudes. Size: (NChannel, NTime)</span>
<span class="sd">        vol: nirfaseterff.base.meshvol</span>
<span class="sd">            Information needed to convert between volumetric and mesh space. Copied from mesh.vol</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="DCSdata.__init__"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.DCSdata.html#nirfasterff.base.data.DCSdata.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amplitude</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tau_DCS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G1_DCS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g1_DCS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="DCSdata.togrid"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.DCSdata.html#nirfasterff.base.data.DCSdata.togrid">[docs]</a>    <span class="k">def</span> <span class="nf">togrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data to volumetric space as is defined in mesh.vol. If it is empty, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        If data is already in volumetric space, function casts data to the new volumetric space</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES the fields phi and phi_DCS</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.dcsmesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in volumetric space. Recasted to the new volume.&#39;</span><span class="p">)</span>
                <span class="n">phi_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="n">phiDCS_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phiDCS_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phiDCS_mesh</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">phi_DCS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_DCS</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">zgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tmp1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">phi_DCS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
                    <span class="n">tmp2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">mesh2grid</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi_DCS</span><span class="p">),</span> <span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">mesh</span><span class="o">.</span><span class="n">source</span><span class="o">.</span><span class="n">num</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">tmp1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span> <span class="o">=</span> <span class="n">tmp2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">vol</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: no converting information found. Ignored. Please run mesh.gen_intmat() first.&#39;</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="DCSdata.tomesh"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.DCSdata.html#nirfasterff.base.data.DCSdata.tomesh">[docs]</a>    <span class="k">def</span> <span class="nf">tomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mesh</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert data back to mesh space using information defined in mesh.vol. If data.vol is empty, the function does nothing.</span>
<span class="sd">        </span>
<span class="sd">        CAUTION: This OVERRIDES fields phi and phi_DCS</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        mesh : nirfasterff.base.dcsmesh</span>
<span class="sd">            mesh whose .vol attribute is used to do the conversion.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvol</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: data already in mesh space. Ignored.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">grid2mesh</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">phi_DCS</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]),</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vol</span> <span class="o">=</span> <span class="n">meshvol</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="DCSdata.isvol"><a class="viewcode-back" href="../../../_autosummary/nirfasterff.base.data.DCSdata.html#nirfasterff.base.data.DCSdata.isvol">[docs]</a>    <span class="k">def</span> <span class="nf">isvol</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if data is in volumetric space.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True if data is in volumetric space, False if not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vol</span><span class="o">.</span><span class="n">xgrid</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Jiaming Cao, MILAB@UoB.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>